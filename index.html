<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>K√Ω s·ªë truy·ªÅn file</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h2>Truy·ªÅn file & k√Ω s·ªë</h2>
        <input type="file" id="fileInput" />
        <button onclick="uploadFile()">G·ª≠i & K√Ω s·ªë</button>
        <div id="status"></div>
        <h3>Danh s√°ch file ƒë√£ upload:</h3>
        <div class="file-list" id="fileList"></div>
        <h3>Ki·ªÉm tra ch·ªØ k√Ω s·ªë:</h3>
        <input type="file" id="verifyFile" /> File g·ªëc<br>
        <input type="file" id="verifySig" /> Ch·ªØ k√Ω s·ªë (.sig)<br>
        <input type="file" id="verifyPub" /> Public Key (.pem)<br>
        <button onclick="verify()">Ki·ªÉm tra ch·ªØ k√Ω</button>
        <div id="verifyResult"></div>
    </div>
    <script>
        function uploadFile() {
            let input = document.getElementById('fileInput');
            if (!input.files.length) {
                alert('Ch·ªçn file tr∆∞·ªõc khi g·ª≠i!');
                return;
            }
            let formData = new FormData();
            formData.append('file', input.files[0]);
            fetch('http://localhost:5000/upload', {
                method: 'POST',
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById('status').innerText = data.message || data.error;
                loadFiles();
            })
            .catch(() => alert('C√≥ l·ªói x·∫£y ra!'));
        }

        function loadFiles() {
            fetch('http://localhost:5000/files')
            .then(res => res.json())
            .then(files => {
                let html = files.map(f =>
                    `<div class="file-item">
                        <a href="http://localhost:5000/download/${f}" download>üìÑ ${f}</a> 
                        | <a href="http://localhost:5000/download_sig/${f}" download>üîè Ch·ªØ k√Ω</a>
                    </div>`
                ).join('');
                html += `<div class="file-item">
                    <a href="http://localhost:5000/download_public_key" download>üóùÔ∏è Public Key (chung)</a>
                </div>`;
                document.getElementById('fileList').innerHTML = html;
            });
        }

        function verify() {
            let f = document.getElementById('verifyFile').files[0];
            let s = document.getElementById('verifySig').files[0];
            let p = document.getElementById('verifyPub').files[0];
            if (!f || !s || !p) {
                alert("Ch·ªçn ƒë·ªß 3 file!");
                return;
            }
            let formData = new FormData();
            formData.append('file', f);
            formData.append('signature', s);
            formData.append('public_key', p);
            fetch('http://localhost:5000/verify', {
                method: 'POST',
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById('verifyResult').innerText = data.result;
            })
            .catch(() => alert('C√≥ l·ªói khi ki·ªÉm tra!'));
        }

        loadFiles();
    </script>
</body>
</html>
